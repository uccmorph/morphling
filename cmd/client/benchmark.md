## 2022.3.29

Morphling读和单机读之间的差距依然不大。

### 1ms延迟
在Morphling的处理循环中加入1ms延迟，预计该循环吞吐为1000 ops。实际客户端测得结果为610 ops。
-cn 为10 或 20都没变化，说明610 ops为上限。
解释：网络栈还会再加入0.5ms延迟

## 2022.3.31
./client -count 100000 -cn 50 -rmode m -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
morphling read 和 unreplicated read之间的最大吞吐差距不大，morphling为44Kops，unreplicated为40Kops
yijian@kvs-backup:~/morphling/cmd/client$ ./multi-client.sh
client                                                                                                                    100% 7467KB  71.0MB/s   00:00
client-run.sh                                                                                                             100%  116   145.6KB/s   00:00
2022/03/31 03:47:26 readMode: m
2022/03/31 03:47:26 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/03/31 03:47:26 50 clients connection complete, will send 100000 total request
2022/03/31 03:47:24 readMode: m
2022/03/31 03:47:24 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/03/31 03:47:24 50 clients connection complete, will send 100000 total request
2022/03/31 03:47:30 total 4.305052806 s, ops: 23228.51879090284
yijian@kvs-backup:~/morphling/cmd/client$ 2022/03/31 03:47:29 total 4.563828329 s, ops: 21911.428912557592
yijian@kvs-backup:~/morphling/cmd/client$ ./multi-client.sh
client                                                                                                                    100% 7467KB  68.8MB/s   00:00
client-run.sh                                                                                                             100%  116   148.2KB/s   00:00
2022/03/31 03:49:04 readMode: u
2022/03/31 03:49:04 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/03/31 03:49:05 50 clients connection complete, will send 100000 total request
2022/03/31 03:49:03 readMode: u
2022/03/31 03:49:03 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/03/31 03:49:03 50 clients connection complete, will send 100000 total request
2022/03/31 03:49:10 total 4.964279613 s, ops: 20143.90964967589
2022/03/31 03:49:08 total 4.838019726 s, ops: 20669.613946092457

统计数据
Raft 2 client machines：
./client -count 10000 -cn 1 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
677804 2947.2010694192245
863566 2314.83841412689
733984 2723.395740638358
781128 2559.3769992165444

./client -count 10000 -cn 2 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
745368 5375.566562883203
640224 6236.780798182697
648272 6180.9193395865095

./client -count 20000 -cn 3 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
745925 8042.4547550092975

./client -count 20000 -cn 4 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
623826 12821.128732150304
634547 12608.855385854316

./client -count 25000 -cn 5 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
712316 14030.97667438272
651996 15320.399060685228
(773641 12908.337159616014

-cn 6
642214 18644.343133535775
848213 14130.626840001125
754548 15883.684614329892

-cn 7
812071 17226.315681966887
749215 18663.12903185663
759440 18405.036814484134

-cn 8
1035854 15427.701293052989
967997 16514.00871164629
943926 16929.6550745634

-cn 9
1026889 17502.610810403217
1093143 16443.62030489428
1005038 17888.13455887309

./client -count 50000 -cn 10 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
1086281 18425.787988294407
998067 20013.866259390423
1091526 18303.73220648327

./client -count 50000 -cn 12 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
1430409 16760.012501519683
1184552 20233.065598069217

./client -count 50000 -cn 15 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
1458707 20530.661969674034
1368695 21882.259212683894

./client -count 50000 -cn 20 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
2234160 17887.50631060454
1526262 26176.884702736068
1807120 22112.66534975305

./client -count 60000 -cn 30 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
2300494 26053.96824288089
2369288 25300.937147402678

./client -count 60000 -cn 40 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
3489922 20853.615396361838
3153307 25301.791061040585

./client -count 60000 -cn 60 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
4269187 28078.239889926474
4623702 25929.170196452083

./client -count 60000 -cn 80 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
5536809 28862.50644846305
5778019 27651.65393230034

./client -count 60000 -cn 100 -rmode r -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
8324618 24093.71065695186
6363443 31388.197559950575
6290673 31755.90634580762
8448871 23644.783769957612


Morphling
./client -count 10000 -cn 1 -rmode m -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
289849 6906.619595961209
289243 6953.633139477847

./client -count 20000 -cn 2 -rmode m -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
302831 13188.307402315932
303550 13140.784019054838

-cn 3
333464 18015.081479144956

-cn 4
326949 24470.660106275976

-cn 5
361631 27559.846364854122
370633 26944.52205232306

-cn 6
432642 27695.460054803843

-cn 7
424282 33061.22389339938

-cn 8
510644 31283.896796129895
499701 31912.465289199048

-cn 9
505443 35512.23498710031

-cn 10
662167 30099.648498486862
633595 31465.960871546617

./client -count 100000 -cn 12 -rmode m -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990' -keys 3
612731 39064.37982045929

-cn 15
741479 40374.88123836621

-cn 20
853128 46815.57728615438
885208 45238.424498232365
875987 45583.61112746918
871974 45769.93611536888

-cn 30
1363215 43938.44448054652
1293966 46287.970809176244

-cn 40
1577289 50539.198656336666
1579845 50603.16863170036

-cn 50
2032654 49145.047400082316

-cn 60
2173832 55151.739028462966

-cn 70
2692297 51891.49637141074

-cn 80
2834049 56345.614706741784

-cn 90
3226572 55748.04741823081

-cn 100
3462903 57691.16825041162

-cn 120
4103053 58451.479938759665

-cn 150
5075446 58871.65697222471

morphling with control

8042.10 248.21
15735.30 253.59
21065.62 284.08
26638.39 299.52
34037.40 292.95
38311.87 312.18
41965.21 332.79
48723.16 327.70
50749.35 353.58
50746.40 396.39
54500.66 442.68
59085.64 508.15
59522.89 605.73
60920.02 654.63
57140.02 873.41
61070.77 989.47
48831.40 1635.76
53545.71 1863.44
55105.34 2175.27


unreplicated with control

8514.47 234.19
17807.67 224.00
24861.08 240.59
29894.80 266.88
29669.89 336.07
32650.68 366.73
28968.78 482.42
29322.34 544.79
31053.36 578.64
34015.44 587.04
31620.20 757.94
30027.47 998.03
29755.05 1208.28
29725.76 1344.07
28276.37 1766.86
28303.99 2118.05
28405.26 2814.11
30528.54 3273.09
30628.01 3912.88

9356.53 213.16
17724.36 225.06
27606.59 216.59
34012.01 234.46
37084.35 268.74
35835.47 334.04
37152.92 375.86
35456.48 450.26
35443.01 506.61
37614.89 530.64
38871.87 615.80
31692.24 945.57
30852.53 1165.78
30421.96 1313.47
31808.57 1570.57
30815.72 1945.35
30444.94 2625.87
32096.47 3113.14
30334.88 3949.57

raft with control
3001.38 665.31
6640.26 601.30
9726.99 615.77
11996.31 665.80
14081.54 709.17
15287.54 784.03
16460.16 849.55
16211.85 985.85
16878.07 1065.29
17095.64 1168.60
18658.62 1285.02
18314.35 1636.55
17616.57 2042.13
21303.70 1876.00
19630.25 2545.00
21233.72 2823.56
23699.16 3373.34
22885.19 4366.83
20938.82 5727.53

## 2022.4.1
single key，并且不使用stat-server情况下，unreplicated可以跑到52Kops.每台机器的测试都在在4秒内完成。
./client -count 100000 -cn 40 -rmode u -saddr '10.1.6.233:9990,10.1.6.234:9990,10.1.6.235:9990'
当-count为400000时，手动运行测试的结果和stat-server类似，为36Kops~44Kops
yijian@kvs-backup:~/morphling/cmd/client$ ./multi-client.sh
client                                                                                                                    100% 9202KB  71.9MB/s   00:00
client-run.sh                                                                                                             100%  108   117.6KB/s   00:00
2022/04/01 02:23:21 readMode: u, writeMode: false, controlMode: false
2022/04/01 02:23:21 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/04/01 02:23:21 40 clients connection complete, will send 400000 total request
2022/04/01 02:23:18 readMode: u, writeMode: false, controlMode: false
2022/04/01 02:23:18 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/04/01 02:23:18 40 clients connection complete, will send 400000 total request
2022/04/01 02:23:43 total 21.872784919 s, ops: 18287.56610012364
2022/04/01 02:23:43 total latency 874188027556, average latency: 2185470 ns
yijian@kvs-backup:~/morphling/cmd/client$ 2022/04/01 02:23:40 total 21.733815874 s, ops: 18404.499344200158
2022/04/01 02:23:40 total latency 868673440427, average latency: 2171683 ns

yijian@kvs-backup:~/morphling/cmd/client$ ./multi-client.sh
client                                                                                                                    100% 9202KB  72.8MB/s   00:00
client-run.sh                                                                                                             100%  108   131.7KB/s   00:00
2022/04/01 02:26:39 readMode: u, writeMode: false, controlMode: false
2022/04/01 02:26:39 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/04/01 02:26:39 40 clients connection complete, will send 400000 total request
2022/04/01 02:26:36 readMode: u, writeMode: false, controlMode: false
2022/04/01 02:26:36 servers: [10.1.6.233:9990 10.1.6.234:9990 10.1.6.235:9990]
2022/04/01 02:26:36 40 clients connection complete, will send 400000 total request
2022/04/01 02:26:57 total 17.743398873 s, ops: 22543.59510615957
2022/04/01 02:26:57 total latency 708875492358, average latency: 1772188 ns
yijian@kvs-backup:~/morphling/cmd/client$ 2022/04/01 02:26:54 total 17.422425852 s, ops: 22958.915331189783
2022/04/01 02:26:54 total latency 696365499569, average latency: 1740913 ns
说明手动运行时误差较大，需要较长时间的运行才能获得真实的吞吐数据
single key的stat-server结果：
7573.53 263.64
16621.82 240.11
24415.74 244.94
33297.42 239.60
33789.30 295.10
37167.26 322.16
36227.46 385.64
37717.44 423.28
35822.89 501.45
35572.16 561.24
34935.75 685.74
33438.68 896.08
34323.39 1047.57
37835.71 1055.97
37506.98 1331.61
36634.80 1635.98
36077.88 2213.60
34086.77 2931.54
41999.69 2849.90
